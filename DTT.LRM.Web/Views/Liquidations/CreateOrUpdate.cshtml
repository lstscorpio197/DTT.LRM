@using Abp.Authorization.Users
@using Abp.Web.Mvc.Extensions
@using DTT.LRM.Authorization
@model DTT.LRM.Web.Models.Liquidations.CreateOrUpdateModel
@{
    ViewBag.ActiveMenu = PageNames.Liquidations; //The menu item will be active for this page.
}
@section scripts
{
    <script src="~/Views/Liquidations/CreateOrUpdate.js"></script>
}
@{
    var isCanCreate = IsGranted(PermissionNames.Pages_Liquidations_Create);
}
<div class="d-flex align-items-center justify-content-between pd-5 bg-white text-black">
    <h4>
        <a href="~/Liquidations/" class="mr-2">
            <svg width="20px" height="20px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 288.312 288.312" style="enable-background:new 0 0 288.312 288.312;" xml:space="preserve">
            <g>
            <path id="Subdirectory_Arrow_Up_Left" d="M127.353,3.555c-4.704-4.74-12.319-4.74-17.011,0L15.314,99.653
		                    c-4.74,4.788-4.547,12.884,0.313,17.48l94.715,95.785c4.704,4.74,12.319,4.74,17.011,0c4.704-4.74,4.704-12.427,0-17.167
		                    l-74.444-75.274h199.474v155.804c0,6.641,5.39,12.03,12.03,12.03c6.641,0,12.03-5.39,12.03-12.03V108.231
		                    c0-6.641-5.39-12.03-12.03-12.03H52.704l74.648-75.49C132.056,15.982,132.056,8.295,127.353,3.555z" />
                    </g>
                </svg>
        </a>
        Thông tin phiếu thanh lý
    </h4>
    @if (isCanCreate)
    {
        <button class="btn btn-primary d-flex align-items-center submit" data-status="0" type="button">
            <svg class="mr-2 color-white" width="20px" height="20px" viewBox="0 0 200 200" data-name="Layer 1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"><title /><path d="M100,15a85,85,0,1,0,85,85A84.93,84.93,0,0,0,100,15Zm0,150a65,65,0,1,1,65-65A64.87,64.87,0,0,1,100,165Zm30-72.5H110v-20a10,10,0,0,0-20,0v20H70a10,10,0,0,0,0,20H90v20a10,10,0,0,0,20,0v-20h20a10,10,0,0,0,0-20Z" /></svg>
            Thực hiện
        </button>
    }
</div>
<form name="LiquidationForm" role="form" novalidate class="form-validation" id="form-wrapper">
    <ul class="nav nav-tabs tab-nav-right mb-3" role="tablist">
        <li role="presentation" class="nav-item">
            <a href="#general-info" data-toggle="tab">Thông tin chung</a>
        </li>
        <li role="presentation">
            <a href="#book-info" data-toggle="tab">Thông tin sách thanh lý</a>
        </li>
    </ul>
    <div class="tab-content">
        <div role="tabpanel" class="tab-pane animated fadeIn active" id="general-info">
            <input type="hidden" name="Id" id="id" value="@Model.Liquidation.Id" />
            <div class="row clearfix" style="margin-top:10px;">
                <div class="col-sm-12">
                    <div class="form-group form-float">
                        <div class="form-line">
                            <input id="code" type="text" name="Code" value="@Model.Liquidation.Code" class="validate form-control">
                            <label for="code" class="form-label">Mã phiếu thanh lý</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row clearfix" style="margin-top:10px;">
                <div class="col-sm-6">
                    <div class="form-group form-float">
                        <div class="form-line">
                            <input id="code" type="date" name="CreateDate" value="@Model.Liquidation.CreateDate.ToString("yyyy-MM-dd")" class="validate form-control">
                            <label for="code" class="form-label">Ngày tạo phiếu</label>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="form-group form-float">
                        <div class="form-line">
                            <input id="name" type="text" name="Creator" value="@Model.Liquidation.Creator" class="validate form-control">
                            <label for="name" class="form-label">Tên người tạo phiếu</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row clearfix">
                <div class="col-sm-12">
                    <div class="form-group form-float">
                        <div class="form-line">
                            <input id="note" type="text" name="Description" value="@Model.Liquidation.Description" class="form-control" />
                            <label for="note" class="form-label">Mô tả</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane animated fadeIn" id="book-info">
            <div class="d-flex mb-5 cursor-pointer btn-trash-row hide">
                <svg class="mr-2" width="20px" height="20px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                     viewBox="0 0 59 59" style="enable-background:new 0 0 59 59;" xml:space="preserve">
                <g>
                <path d="M52.5,6H38.456c-0.11-1.25-0.495-3.358-1.813-4.711C35.809,0.434,34.751,0,33.499,0H23.5c-1.252,0-2.31,0.434-3.144,1.289
		                C19.038,2.642,18.653,4.75,18.543,6H6.5c-0.552,0-1,0.447-1,1s0.448,1,1,1h46c0.552,0,1-0.447,1-1S53.052,6,52.5,6z M21.792,2.681
		                C22.24,2.223,22.799,2,23.5,2h9.999c0.701,0,1.26,0.223,1.708,0.681c0.805,0.823,1.128,2.271,1.24,3.319H20.553
		                C20.665,4.952,20.988,3.504,21.792,2.681z" />
                <path d="M10.456,54.021C10.493,55.743,11.565,59,15.364,59h28.272c3.799,0,4.871-3.257,4.907-4.958L50.376,10H8.624L10.456,54.021z
		                 M48.291,12l-1.747,41.979C46.538,54.288,46.4,57,43.636,57H15.364c-2.734,0-2.898-2.717-2.909-3.042L10.709,12H48.291z" />
                <path d="M17.5,54h24c0.552,0,1-0.447,1-1s-0.448-1-1-1h-24c-0.552,0-1,0.447-1,1S16.948,54,17.5,54z" />
                <path d="M17.5,49h24c0.552,0,1-0.447,1-1s-0.448-1-1-1h-24c-0.552,0-1,0.447-1,1S16.948,49,17.5,49z" />
                <path d="M17.5,44h24c0.552,0,1-0.447,1-1s-0.448-1-1-1h-24c-0.552,0-1,0.447-1,1S16.948,44,17.5,44z" />
                </g>
                </svg> Xóa dòng
            </div>
            <table class="table" id="tblBookLiquidation">
                <thead>
                    <tr>
                        <th scope="col">
                            <input id="checkbox-all" type="checkbox" name="Checkbox" value="" class="form-control" />
                            <label for="checkbox-all" class="btn-checkbox"></label>
                        </th>
                        <th scope="col">STT</th>

                        <th scope="col">Loại sách</th>
                        <th scope="col">Tác giả</th>
                        <th scope="col">Nhà xuất bản</th>
                        <th scope="col">Năm xuất bản</th>
                        <th scope="col">Giá thanh lý</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Liquidation.Id > 0 && Model.ListBookLiquidations.Any())
                    {
                        int i = 0;
                        foreach (var bookLiquidation in Model.ListBookLiquidations)
                        {
                            <tr data-id="@bookLiquidation.Id">
                                <th scope="row">
                                    <input id="checkbox-@i" type="checkbox" name="Checkbox" value="" class="form-control" />
                                    <label for="checkbox-@i" class="btn-checkbox"></label>
                                </th>
                                <td class="stt">@(i + 1)</td>
                                <td>

                                    @{var bookCategory = Model.ListBookCategories.FirstOrDefault(x => x.Id == bookLiquidation.BookCategorieId);}
                                    <input type="hidden" class="form-control" value="@(bookCategory.Id)" readonly />
                                    <input type="text" class="form-control" style="width:auto" value="@(bookCategory.Name)" readonly />
                                </td>
                                <td>
                                    <input type="text" class="form-control author" value="@bookLiquidation.Author" readonly />
                                </td>
                                <td>
                                    <input type="hidden" class="form-control publisherid" value="@(bookLiquidation.PublisherId)" readonly />
                                    <input type="text" class="form-control publisher" value="@(bookLiquidation.Publisher?.Name)" readonly />
                                </td>
                                <td>
                                    <input type="text" class="form-control releaseyear" value="@bookLiquidation.ReleaseYear" readonly />
                                </td>
                                <td>
                                    <input type="number" class="form-control liquidationprice" value="@(Math.Round(bookLiquidation.LiquidationPrice))" readonly />
                                </td>
                            </tr>
                            i++;
                        }
                    }
                    else
                    {
                        <tr data-id="0">
                            <th scope="row">
                                <input id="checkbox" type="checkbox" name="Checkbox" value="" class="form-control" />
                                <label for="checkbox" class="btn-checkbox"></label>
                            </th>
                            <td class="stt">1</td>
                            <td class="form-line">
                                <select class="selectpicker show-tick form-control" data-width="100%" width="auto" data-live-search="true" name="BookCategoryId">
                                    <option value="">-- Chọn tên sách --</option>
                                    @foreach (var item in Model.ListBookCategories)
                                    {
                                        <option value="@item.Id">@item.Name</option>
                                    }
                                </select>
                            </td>
                            <td>
                                <input type="text" class="form-control author" value="" />
                            </td>
                            <td class="form-line">
                                <select class="selectpicker show-tick form-control" data-width="100%" width="auto" data-live-search="true" name="PublisherId">
                                    <option value="">-- Chọn nhà xuất bản --</option>
                                    @foreach (var item in Model.ListPublishers)
                                    {
                                        <option value="@item.Id">@item.Name</option>
                                    }
                                </select>
                            </td>
                            <td>
                                <input type="text" class="form-control releaseyear" value=""  />
                            </td>
                            <td>
                                <input type="text" class="form-control liquidationprice" value="" />
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
            <a class="add-row cursor-pointer">Thêm sách</a>
        </div>
    </div>
</form>


